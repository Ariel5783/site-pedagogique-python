---
title: "Mini-Projet : Gestion d'un r√©seau de capteurs IoT"
level: ["BTS CIEL"]
type: "exercices"
objectifs:
  - "Appliquer la POO en situation r√©elle"
  - "Manipuler des fichiers JSON"
  - "Simuler des capteurs IoT"
  - "Traiter et analyser des donn√©es"
prerequis:
  - "Programmation orient√©e objet"
  - "Manipulation de fichiers"
  - "Structures de donn√©es"
duree_estimee: "5h00"
auteur: "Eric MORMIN"
updated: "2025-12-14"
mots_cles: ["projet", "iot", "capteurs", "json", "poo", "statistiques"]
mode_defi: true
---

import InteractiveBlock from '../../components/InteractiveBlock.astro';
import TeacherOnly from '../../components/TeacherOnly.astro';

## Contexte

Dans le cadre de votre formation en BTS CIEL, vous allez d√©velopper une application Python permettant de g√©rer un **r√©seau de capteurs IoT** (Internet des Objets). Ce projet simule des capteurs de temp√©rature, humidit√© et pression.

## Objectifs p√©dagogiques

- Appliquer les principes de la programmation orient√©e objet (POO)
- Manipuler des **fichiers JSON** pour stocker et charger des donn√©es
- Simuler des **capteurs de mesure** avec g√©n√©ration de valeurs al√©atoires
- Concevoir une **interface en ligne de commande interactive**
- Traiter les donn√©es pour afficher des **statistiques utiles**

## Consignes g√©n√©rales

Vous devez d√©velopper un programme Python permettant de :

1. **Ajouter un capteur** (nom, type, emplacement)
2. **G√©n√©rer des mesures** al√©atoires pour chaque capteur
3. **Afficher les mesures** enregistr√©es
4. **Sauvegarder/charger** les donn√©es dans un fichier JSON
5. **Calculer des statistiques** (moyenne, min, max)
6. **Rechercher un capteur** par nom ou type

<div class="alert alert-info mb-6">
  <div class="flex items-start">
    <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
    </svg>
    <div>
      <p class="font-medium">Organisation du projet</p>
      <ul class="text-sm mt-2 space-y-1">
        <li>Cr√©ez 3 fichiers : main.py, capteur.py, gestion_iot.py</li>
        <li>Utilisez le module json pour la sauvegarde</li>
        <li>Utilisez random pour g√©n√©rer des mesures</li>
        <li>Utilisez datetime pour les horodatages</li>
      </ul>
    </div>
  </div>
</div>

## Structure du projet

```
iot_project/
‚îú‚îÄ‚îÄ main.py         # Interface utilisateur
‚îú‚îÄ‚îÄ capteur.py      # Classe Capteur
‚îú‚îÄ‚îÄ gestion_iot.py  # Gestion des capteurs
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ mesures.json  # Donn√©es sauvegard√©es
```

## Partie 1 : Cr√©ation de la classe `Capteur`

Chaque capteur doit avoir :
- Un **nom** (str)
- Un **type** : `temperature`, `humidite`, ou `pression`
- Un **emplacement** (str)
- Une **liste de mesures** avec horodatage

**M√©thodes √† impl√©menter :**
- `generer_mesure()` : G√©n√®re une valeur al√©atoire selon le type
- `afficher_infos()` : Affiche les informations du capteur
- `to_dict()` : Convertit en dictionnaire pour JSON
- `from_dict(data)` : Cr√©e un capteur depuis un dictionnaire

**Plages de valeurs :**
- Temp√©rature : 15¬∞C √† 30¬∞C
- Humidit√© : 30% √† 80%
- Pression : 980 hPa √† 1050 hPa

<InteractiveBlock
  id="classe-capteur"
  title="Votre code : capteur.py"
  type="code"
  placeholder="import random
from datetime import datetime

class Capteur:
    def __init__(self, nom, type_capteur, emplacement):
        # Votre code ici
        pass
    
    def generer_mesure(self):
        # G√©n√®re une mesure selon le type
        pass
    
    def afficher_infos(self):
        # Affiche les infos
        pass
    
    def to_dict(self):
        # Convertit en dict
        pass
    
    @staticmethod
    def from_dict(data):
        # Cr√©e depuis dict
        pass
"
/>

## Partie 2 : Gestion des capteurs

Cr√©ez la classe `GestionIoT` qui g√®re :
- Liste des capteurs
- Ajout de capteurs
- G√©n√©ration de mesures pour tous les capteurs
- Sauvegarde/chargement JSON
- Recherche de capteurs
- Calcul de statistiques

<InteractiveBlock
  id="gestion-iot"
  title="Votre code : gestion_iot.py"
  type="code"
  placeholder="import json
from capteur import Capteur

class GestionIoT:
    def __init__(self):
        # Votre code ici
        pass
    
    def ajouter_capteur(self, capteur):
        pass
    
    def generer_toutes_mesures(self):
        pass
    
    def sauvegarder(self, fichier):
        pass
    
    def charger(self, fichier):
        pass
    
    def rechercher(self, critere, valeur):
        pass
    
    def statistiques(self, nom_capteur):
        pass
"
/>

## Partie 3 : Interface utilisateur

Cr√©ez un menu interactif proposant :
1. Ajouter un capteur
2. G√©n√©rer des mesures
3. Afficher tous les capteurs
4. Afficher les statistiques d'un capteur
5. Rechercher un capteur
6. Sauvegarder les donn√©es
7. Charger les donn√©es
8. Quitter

<InteractiveBlock
  id="menu-iot"
  title="Votre code : main.py"
  type="code"
  placeholder="from gestion_iot import GestionIoT
from capteur import Capteur

def menu():
    iot = GestionIoT()
    
    while True:
        print('\\n=== Gestion Capteurs IoT ===')
        print('1. Ajouter un capteur')
        print('2. G√©n√©rer mesures')
        print('3. Afficher capteurs')
        print('4. Statistiques')
        print('5. Rechercher')
        print('6. Sauvegarder')
        print('7. Charger')
        print('8. Quitter')
        
        # Votre code ici
        pass

if __name__ == '__main__':
    menu()
"
/>

## Exemple d'utilisation

```python
# Cr√©ation d'un capteur
capteur1 = Capteur("Capteur1", "temperature", "Salle Serveur")

# G√©n√©ration de mesures
capteur1.generer_mesure()
capteur1.generer_mesure()

# Affichage
capteur1.afficher_infos()
# Sortie :
# Nom: Capteur1
# Type: temperature
# Emplacement: Salle Serveur
# Mesures: [23.5¬∞C (2025-12-14 10:30), 24.1¬∞C (2025-12-14 10:35)]
```

## √âvaluation (sur 20 points)

‚úÖ **Classe Capteur** (5 points)
- Structure et attributs : 1 point
- M√©thode generer_mesure : 1.5 point
- M√©thodes to_dict/from_dict : 1.5 point
- Affichage : 1 point

‚úÖ **Classe GestionIoT** (8 points)
- Structure : 1 point
- Ajout/recherche capteurs : 2 points
- Sauvegarde/chargement JSON : 3 points
- Statistiques : 2 points

‚úÖ **Interface utilisateur** (4 points)
- Menu complet : 2 points
- Gestion des options : 2 points

‚úÖ **Code et organisation** (3 points)
- Organisation en modules : 1 point
- Gestion d'erreurs : 1 point
- Documentation : 1 point

## Livrables

üìå 3 fichiers Python (main.py, capteur.py, gestion_iot.py)  
üìå Fichier README.md expliquant l'utilisation  
üìå Exemple de fichier mesures.json

<TeacherOnly title="Corrig√© complet du projet IoT">

## Solution compl√®te

### 1. Fichier capteur.py

```python
import random
from datetime import datetime

class Capteur:
    """Repr√©sente un capteur IoT"""
    
    # Plages de valeurs par type
    PLAGES = {
        'temperature': (15, 30),
        'humidite': (30, 80),
        'pression': (980, 1050)
    }
    
    def __init__(self, nom, type_capteur, emplacement):
        """
        Initialise un capteur
        
        Args:
            nom (str): Nom du capteur
            type_capteur (str): Type (temperature, humidite, pression)
            emplacement (str): Lieu d'installation
        """
        if type_capteur not in self.PLAGES:
            raise ValueError(f"Type invalide. Choisir parmi: {list(self.PLAGES.keys())}")
        
        self.nom = nom
        self.type = type_capteur
        self.emplacement = emplacement
        self.mesures = []  # Liste de tuples (timestamp, valeur)
    
    def generer_mesure(self):
        """G√©n√®re et enregistre une nouvelle mesure"""
        min_val, max_val = self.PLAGES[self.type]
        valeur = round(random.uniform(min_val, max_val), 2)
        timestamp = datetime.now().isoformat()
        self.mesures.append((timestamp, valeur))
        return valeur
    
    def afficher_infos(self):
        """Affiche les informations du capteur"""
        print(f"\n{'='*50}")
        print(f"Capteur: {self.nom}")
        print(f"Type: {self.type}")
        print(f"Emplacement: {self.emplacement}")
        print(f"Nombre de mesures: {len(self.mesures)}")
        
        if self.mesures:
            print(f"\nDerni√®re mesure: {self.mesures[-1][1]} ({self.mesures[-1][0]})")
    
    def obtenir_statistiques(self):
        """Calcule les statistiques sur les mesures"""
        if not self.mesures:
            return None
        
        valeurs = [m[1] for m in self.mesures]
        return {
            'moyenne': round(sum(valeurs) / len(valeurs), 2),
            'min': min(valeurs),
            'max': max(valeurs),
            'count': len(valeurs)
        }
    
    def to_dict(self):
        """Convertit le capteur en dictionnaire pour JSON"""
        return {
            'nom': self.nom,
            'type': self.type,
            'emplacement': self.emplacement,
            'mesures': self.mesures
        }
    
    @staticmethod
    def from_dict(data):
        """Cr√©e un capteur depuis un dictionnaire"""
        capteur = Capteur(data['nom'], data['type'], data['emplacement'])
        capteur.mesures = data.get('mesures', [])
        return capteur
```

### 2. Fichier gestion_iot.py

```python
import json
import os
from capteur import Capteur

class GestionIoT:
    """G√®re un r√©seau de capteurs IoT"""
    
    def __init__(self):
        """Initialise le gestionnaire"""
        self.capteurs = []
    
    def ajouter_capteur(self, capteur):
        """Ajoute un capteur au r√©seau"""
        if any(c.nom == capteur.nom for c in self.capteurs):
            print(f"Erreur: Un capteur '{capteur.nom}' existe d√©j√†.")
            return False
        
        self.capteurs.append(capteur)
        print(f"‚úì Capteur '{capteur.nom}' ajout√© avec succ√®s.")
        return True
    
    def generer_toutes_mesures(self):
        """G√©n√®re une mesure pour chaque capteur"""
        if not self.capteurs:
            print("Aucun capteur disponible.")
            return
        
        print("\nG√©n√©ration des mesures...")
        for capteur in self.capteurs:
            valeur = capteur.generer_mesure()
            print(f"  {capteur.nom}: {valeur}")
    
    def afficher_tous_capteurs(self):
        """Affiche tous les capteurs"""
        if not self.capteurs:
            print("Aucun capteur enregistr√©.")
            return
        
        print(f"\n{'='*50}")
        print(f"{'Nom':<20} {'Type':<15} {'Emplacement':<15}")
        print('='*50)
        for capteur in self.capteurs:
            print(f"{capteur.nom:<20} {capteur.type:<15} {capteur.emplacement:<15}")
    
    def rechercher(self, critere, valeur):
        """
        Recherche des capteurs selon un crit√®re
        
        Args:
            critere (str): 'nom', 'type', ou 'emplacement'
            valeur (str): Valeur √† rechercher
        """
        resultats = [c for c in self.capteurs if getattr(c, critere, '').lower() == valeur.lower()]
        
        if not resultats:
            print(f"Aucun capteur trouv√© avec {critere}='{valeur}'")
            return []
        
        print(f"\n{len(resultats)} capteur(s) trouv√©(s):")
        for capteur in resultats:
            capteur.afficher_infos()
        
        return resultats
    
    def afficher_statistiques(self, nom_capteur):
        """Affiche les statistiques d'un capteur"""
        capteur = next((c for c in self.capteurs if c.nom == nom_capteur), None)
        
        if not capteur:
            print(f"Capteur '{nom_capteur}' introuvable.")
            return
        
        stats = capteur.obtenir_statistiques()
        
        if not stats:
            print(f"Aucune mesure disponible pour '{nom_capteur}'.")
            return
        
        print(f"\n{'='*50}")
        print(f"Statistiques pour {nom_capteur}")
        print('='*50)
        print(f"Nombre de mesures: {stats['count']}")
        print(f"Moyenne: {stats['moyenne']}")
        print(f"Minimum: {stats['min']}")
        print(f"Maximum: {stats['max']}")
    
    def sauvegarder(self, fichier='mesures.json'):
        """Sauvegarde les donn√©es dans un fichier JSON"""
        try:
            # Cr√©er le dossier data s'il n'existe pas
            os.makedirs('data', exist_ok=True)
            chemin = os.path.join('data', fichier)
            
            data = {
                'capteurs': [c.to_dict() for c in self.capteurs]
            }
            
            with open(chemin, 'w', encoding='utf-8') as f:
                json.dump(data, f, indent=2, ensure_ascii=False)
            
            print(f"‚úì Donn√©es sauvegard√©es dans '{chemin}'")
            return True
        
        except Exception as e:
            print(f"Erreur lors de la sauvegarde: {e}")
            return False
    
    def charger(self, fichier='mesures.json'):
        """Charge les donn√©es depuis un fichier JSON"""
        try:
            chemin = os.path.join('data', fichier)
            
            if not os.path.exists(chemin):
                print(f"Fichier '{chemin}' introuvable.")
                return False
            
            with open(chemin, 'r', encoding='utf-8') as f:
                data = json.load(f)
            
            self.capteurs = [Capteur.from_dict(c) for c in data['capteurs']]
            print(f"‚úì {len(self.capteurs)} capteur(s) charg√©(s) depuis '{chemin}'")
            return True
        
        except Exception as e:
            print(f"Erreur lors du chargement: {e}")
            return False
```

### 3. Fichier main.py

```python
from gestion_iot import GestionIoT
from capteur import Capteur

def menu():
    """Menu principal de l'application"""
    iot = GestionIoT()
    
    # Charger les donn√©es si elles existent
    iot.charger()
    
    while True:
        print("\n" + "="*50)
        print("üåê GESTION DE CAPTEURS IoT üåê")
        print("="*50)
        print("1. Ajouter un capteur")
        print("2. G√©n√©rer des mesures")
        print("3. Afficher tous les capteurs")
        print("4. Afficher statistiques d'un capteur")
        print("5. Rechercher un capteur")
        print("6. Sauvegarder les donn√©es")
        print("7. Charger les donn√©es")
        print("8. Quitter")
        print("="*50)
        
        choix = input("Votre choix : ").strip()
        
        if choix == "1":
            print("\n--- Ajouter un capteur ---")
            nom = input("Nom du capteur : ").strip()
            print("Types disponibles: temperature, humidite, pression")
            type_cap = input("Type de capteur : ").strip().lower()
            emplacement = input("Emplacement : ").strip()
            
            if nom and type_cap and emplacement:
                try:
                    capteur = Capteur(nom, type_cap, emplacement)
                    iot.ajouter_capteur(capteur)
                except ValueError as e:
                    print(f"Erreur: {e}")
            else:
                print("Erreur: Tous les champs sont requis.")
        
        elif choix == "2":
            iot.generer_toutes_mesures()
        
        elif choix == "3":
            iot.afficher_tous_capteurs()
        
        elif choix == "4":
            nom = input("Nom du capteur : ").strip()
            if nom:
                iot.afficher_statistiques(nom)
            else:
                print("Nom requis.")
        
        elif choix == "5":
            print("\nCrit√®res: nom, type, emplacement")
            critere = input("Crit√®re de recherche : ").strip().lower()
            valeur = input("Valeur √† rechercher : ").strip()
            
            if critere in ['nom', 'type', 'emplacement'] and valeur:
                iot.rechercher(critere, valeur)
            else:
                print("Crit√®re ou valeur invalide.")
        
        elif choix == "6":
            iot.sauvegarder()
        
        elif choix == "7":
            iot.charger()
        
        elif choix == "8":
            print("\nSauvegarde automatique...")
            iot.sauvegarder()
            print("Au revoir ! üëã")
            break
        
        else:
            print("Choix invalide.")

if __name__ == "__main__":
    menu()
```

### 4. Exemple de fichier mesures.json

```json
{
  "capteurs": [
    {
      "nom": "Capteur1",
      "type": "temperature",
      "emplacement": "Salle Serveur",
      "mesures": [
        ["2025-12-14T10:30:00", 23.5],
        ["2025-12-14T10:35:00", 24.1]
      ]
    },
    {
      "nom": "Capteur2",
      "type": "humidite",
      "emplacement": "Bureau",
      "mesures": [
        ["2025-12-14T10:30:00", 55.3],
        ["2025-12-14T10:35:00", 56.8]
      ]
    }
  ]
}
```

## Bar√®me d√©taill√©

### Classe Capteur (5 points)
- Structure et validation : 1 point
- generer_mesure() : 1.5 point
- to_dict() et from_dict() : 1.5 point
- obtenir_statistiques() : 1 point

### Classe GestionIoT (8 points)
- Structure : 1 point
- ajouter_capteur() avec v√©rification : 1 point
- rechercher() : 1 point
- sauvegarder() JSON : 2 points
- charger() JSON : 2 points
- afficher_statistiques() : 1 point

### Interface utilisateur (4 points)
- Menu complet et clair : 2 points
- Gestion de toutes les options : 2 points

### Code et organisation (3 points)
- Organisation modulaire : 1 point
- Gestion d'erreurs : 1 point
- Documentation et commentaires : 1 point

## Extensions possibles

1. **Alertes** : D√©clencher des alertes si valeurs hors limites
2. **Graphiques** : Visualiser les mesures avec matplotlib
3. **Export CSV** : Exporter les donn√©es au format CSV
4. **Historique** : Supprimer les vieilles mesures
5. **API REST** : Exposer les donn√©es via Flask

</TeacherOnly>
